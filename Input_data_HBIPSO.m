% prep_evcs_data_compact.m
clear; clc;

isDistanceInMeters = true;

POINTS = {'LK1','LK2','LK3','LK4','LK5','LK6','LK7','LK8','LK9','LK10', ...
          'LK11','LK12','LK13','LK14','LK15','LK16','LK17','LK18','LK19','LK20', ...
          'LK21','LK22','LK23','LK24','LK25','LK26','LK27','LK28','LK29', ...
          'BT1','BT2','BT3','BT4','CC-HH1','CC-HH2'};
STATIONS = {'CC-TM1','CC-HH1','CC-TT1','CC-TM2','CC-TM3','CC-BDX','CC-HH2','CC-TLC'};
TYPES = {'xe_may','oto5','oto7','taxi5','taxi7','bus'};

SCF    = [0.35 0.35 0.35 0.34 0.34 0.44];
areaT  = [1.48 12.5 13.2 12.5 13.2 40.0];
powerT = [3.5 11 22 11 22 150];

EVcount = [ ...
  35  5  2  0  0  0; 38  7  1  0  0  0; 40  6  3  0  0  0; 41  5  2  0  0  0; 39  6  1  0  0  0;
  36  6  2  0  0  0; 34  7  3  0  0  0; 37  6  2  0  0  0; 38  5  3  0  0  0; 36  6  2  0  0  0;
  35  5  2  0  0  0; 37  7  1  0  0  0; 39  6  3  0  0  0; 38  5  2  0  0  0; 36  6  1  0  0  0;
  37  5  3  0  0  0; 38  6  2  0  0  0; 40  5  1  0  0  0; 39  6  2  0  0  0; 37  5  3  0  0  0;
  35  7  1  0  0  0; 36  6  3  0  0  0; 38  5  2  0  0  0; 37  6  1  0  0  0; 39  5  3  0  0  0;
  40  6  2  0  0  0; 38  5  1  0  0  0; 36  6  2  0  0  0; 35  7  3  0  0  0;
  34  6  2  0  0  0; 36  5  3  0  0  0; 37  7  1  0  0  0; 39  6  2  0  0  0;
 120 40 20 82 82  0; 130 50 25 121 121 0];

maxCharger = [ ...
 100 50 50 30 30  0;
 100 50 50 30 30  0;
 100 50 50 30 30  0;
 100 50 50 30 30  0;
 100 50 50 30 30  0;
  50 30 30  0  0 10;
 100 50 50 30 30  0;
  80 40 40 20 20  0];

DIST = [ ...
   483  229  292  574 1117 1376 1467 1202;
   585  359  172  642  996 1072 1178 1291;
   312  160  132  322  907 1098 1207  987;
   329  186  301  466  972 1142 1301 1186;
   204  228  325  459 1236 1398 1438  996;
   214  241  207  353 1088 1294 1305 1009;
   680  633  211   70  733  869  849  521;
  1002  879  496  434  346  469  484  238;
  1193 1025  706  605  545  644  621  484;
   605  423  239  382  629  799  790  578;
  1111  763  581  371  241  617  917  739;
   687  525  328  392  532 1007 1370  558;
   862  613  352  329  599 1032 1370  772;
   858  643  300  342  805 1041  844  739;
   606  510  312  762  687  844 1091  605;
   963  728  617  666  931  658  258  819;
   903  689  515  542  336  518  617  451;
  1105  830  615  665  258  627  549  304;
  1140  951  660  725  150  369  382  430;
   981  792  526  543  224  290  503  431;
  1011  848  525  490  230  417  433  320;
  1085  945  586  546  279  488  390  314;
  1089  972  598  466  415  331  409  260;
  1260 1120  705  672  498  495  391  123;
  1342 1299  903  839  382  332  351  115;
  1436 1255  930  730  817  332  101  123;
  1366 1166  886  861   60  374   84  349;
  1386 1190  934  931   95  810  244  283;
  1228 1007  802  832  195  309  484  291;
   784  707  408  171  699  689  675  413;
   780  707  363  168  695  875  854  475;
   980  901  514  410  512  597  522  342;
   915  703  517  410  612  529  532  409;
   265  205  428  615 1175 1371 1352  152;
  1674 1532 1190 1095  384  232  532 1290];

dist = DIST; if isDistanceInMeters, dist = DIST/1000; end
[n,m] = size(dist);
assert(m==numel(STATIONS) && n==numel(POINTS),'DIST size mismatch.');

D    = EVcount*SCF(:);
Cmax = sum(maxCharger,2);

dem  = sum(EVcount,1).*SCF;
pt   = dem ./ max(sum(dem),eps);
A_eff = pt*areaT(:);
Astall = repmat(A_eff,m,1);

Q = 1;
Dmax = max(dist(:));

wraw = [1/3 0.33 0.33]; wraw = wraw/sum(wraw);
w1 = wraw(1); w2 = wraw(2); w3 = wraw(3);

[rhoU,rhoVcap,rhoVdist,rhoVlogic,lambda_pen] = deal(1,1,1,5,10);

save('evcs_data.mat','D','dist','Astall','Cmax','Q','Dmax','w1','w2','w3', ...
     'rhoU','rhoVcap','rhoVdist','rhoVlogic','lambda_pen', ...
     'POINTS','STATIONS','TYPES','SCF','areaT','powerT','EVcount','maxCharger');

fprintf('âœ“ evcs_data.mat | n=%d, m=%d | SumD=%.2f | Aeff=%.2f | SumCmax=%d\n', ...
        n,m,sum(D),A_eff,sum(Cmax));
%=====================================================================================